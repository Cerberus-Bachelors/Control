<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="odrive_robot">

  <!-- Arguments controlling whether each of the 12 joints is enabled -->
  <xacro:arg name="enable_joint0"  default="false" />
  <xacro:arg name="enable_joint1"  default="false" />
  <xacro:arg name="enable_joint2"  default="false" />
  <xacro:arg name="enable_joint3"  default="false" />
  <xacro:arg name="enable_joint4"  default="false" />
  <xacro:arg name="enable_joint5"  default="false" />
  <xacro:arg name="enable_joint6"  default="false" />
  <xacro:arg name="enable_joint7"  default="false" />
  <xacro:arg name="enable_joint8"  default="false" />
  <xacro:arg name="enable_joint9"  default="false" />
  <xacro:arg name="enable_joint10" default="false" />
  <xacro:arg name="enable_joint11" default="false" />

  <!-- Arguments for up to 6 ODrive boards (2 axes each) -->
  <xacro:arg name="odrive_1_serial" default="2081356E524B" />
  <xacro:arg name="odrive_2_serial" default="20763599524B" />
  <xacro:arg name="odrive_3_serial" default="000000000000" />
  <xacro:arg name="odrive_4_serial" default="000000000000" />
  <xacro:arg name="odrive_5_serial" default="000000000000" />
  <xacro:arg name="odrive_6_serial" default="000000000000" />

  <!-- Include your custom ODrive xacro definition that handles up to two axes -->
  <xacro:include filename="$(find cerberus_description)/urdf/odrive.ros2_control.xacro" />

  <!-- A world link to anchor everything -->
  <link name="world" />

  <!-- Define 12 links and 12 joints, each optional behind an enable_jointN check -->
  <xacro:if value="$(arg enable_joint0)">
    <link name="link0" />
    <joint name="joint0" type="continuous">
      <parent link="world"/>
      <child link="link0"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint1)">
    <link name="link1" />
    <joint name="joint1" type="continuous">
      <parent link="world"/>
      <child link="link1"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint2)">
    <link name="link2" />
    <joint name="joint2" type="continuous">
      <parent link="world"/>
      <child link="link2"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint3)">
    <link name="link3" />
    <joint name="joint3" type="continuous">
      <parent link="world"/>
      <child link="link3"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint4)">
    <link name="link4" />
    <joint name="joint4" type="continuous">
      <parent link="world"/>
      <child link="link4"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint5)">
    <link name="link5" />
    <joint name="joint5" type="continuous">
      <parent link="world"/>
      <child link="link5"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint6)">
    <link name="link6" />
    <joint name="joint6" type="continuous">
      <parent link="world"/>
      <child link="link6"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint7)">
    <link name="link7" />
    <joint name="joint7" type="continuous">
      <parent link="world"/>
      <child link="link7"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint8)">
    <link name="link8" />
    <joint name="joint8" type="continuous">
      <parent link="world"/>
      <child link="link8"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint9)">
    <link name="link9" />
    <joint name="joint9" type="continuous">
      <parent link="world"/>
      <child link="link9"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint10)">
    <link name="link10" />
    <joint name="joint10" type="continuous">
      <parent link="world"/>
      <child link="link10"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>

  <xacro:if value="$(arg enable_joint11)">
    <link name="link11" />
    <joint name="joint11" type="continuous">
      <parent link="world"/>
      <child link="link11"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:if>


  <!-- Now define 6 possible ODrive boards, each controlling 2 joints -->
  <!-- ODrive #1: controls joint0 and joint1 -->
  <xacro:odrive_ros2_control
    name="odrive1_ros2_control"
    sensor_name="odrv0"
    serial_number="$(arg odrive_1_serial)"
    joint0_name="joint0" enable_joint0="$(arg enable_joint0)"
    joint1_name="joint1" enable_joint1="$(arg enable_joint1)" />

  <!-- ODrive #2: controls joint2 and joint3 -->
  <xacro:odrive_ros2_control
    name="odrive2_ros2_control"
    sensor_name="odrv1"
    serial_number="$(arg odrive_2_serial)"
    joint0_name="joint2" enable_joint0="$(arg enable_joint2)"
    joint1_name="joint3" enable_joint1="$(arg enable_joint3)" />

  <!-- ODrive #3: controls joint4 and joint5 -->
  <xacro:odrive_ros2_control
    name="odrive3_ros2_control"
    sensor_name="odrv2"
    serial_number="$(arg odrive_3_serial)"
    joint0_name="joint4" enable_joint0="$(arg enable_joint4)"
    joint1_name="joint5" enable_joint1="$(arg enable_joint5)" />

  <!-- ODrive #4: controls joint6 and joint7 -->
  <xacro:odrive_ros2_control
    name="odrive4_ros2_control"
    sensor_name="odrv3"
    serial_number="$(arg odrive_4_serial)"
    joint0_name="joint6" enable_joint0="$(arg enable_joint6)"
    joint1_name="joint7" enable_joint1="$(arg enable_joint7)" />

  <!-- ODrive #5: controls joint8 and joint9 -->
  <xacro:odrive_ros2_control
    name="odrive5_ros2_control"
    sensor_name="odrv4"
    serial_number="$(arg odrive_5_serial)"
    joint0_name="joint8" enable_joint0="$(arg enable_joint8)"
    joint1_name="joint9" enable_joint1="$(arg enable_joint9)" />

  <!-- ODrive #6: controls joint10 and joint11 -->
  <xacro:odrive_ros2_control
    name="odrive6_ros2_control"
    sensor_name="odrv5"
    serial_number="$(arg odrive_6_serial)"
    joint0_name="joint10" enable_joint0="$(arg enable_joint10)"
    joint1_name="joint11" enable_joint1="$(arg enable_joint11)" />

</robot>
